<!DOCTYPE html> <html lang="en"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> [Papers] Generalizable and Animatable Gaussian Head Avatar (NeurIPS 2024) | owei </title> <meta name="author" content="owei "> <meta name="description" content="Code Review"> <meta name="keywords" content="jekyll, jekyll-theme, academic-website, portfolio-website"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="data:image/svg+xml,&lt;svg%20xmlns=%22http://www.w3.org/2000/svg%22%20viewBox=%220%200%20100%20100%22&gt;&lt;text%20y=%22.9em%22%20font-size=%2290%22&gt;%F0%9F%96%A4&lt;/text&gt;&lt;/svg&gt;"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://oweixx.github.io/blog/2025/papers_GAGAvatars/"> <script src="/assets/js/theme.js?9a0c749ec5240d9cda97bc72359a72c0"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav "> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <span class="font-weight-bold">owei</span> </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">about </a> </li> <li class="nav-item active"> <a class="nav-link" href="/blog/">blog </a> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">[Papers] Generalizable and Animatable Gaussian Head Avatar (NeurIPS 2024)</h1> <p class="post-meta"> Created on November 19, 2025 </p> <p class="post-tags"> <a href="/blog/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/blog/tag/paper"> <i class="fa-solid fa-hashtag fa-sm"></i> Paper</a>   ·   <a href="/blog/category/paper"> <i class="fa-solid fa-tag fa-sm"></i> Paper</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h2 id="generalizable-and-animatable-gaussian-head-avatar">Generalizable and Animatable Gaussian Head Avatar</h2> <h3 id="papergithubproject"> <a href="https://arxiv.org/abs/2410.07971" rel="external nofollow noopener" target="_blank">[Paper]</a><a href="https://github.com/xg-chu/GAGAvatar" rel="external nofollow noopener" target="_blank">[Github]</a><a href="https://xg-chu.site/project_gagavatar/" rel="external nofollow noopener" target="_blank">[Project]</a> </h3> <blockquote> <p><strong>Title:</strong> Generalizable and Animatable Gaussian Head Avatar <br> <strong>Journal name &amp; Publication Date:</strong> NeurIPS 2024-10-10<br> <strong>Affiliation:</strong> The University of Tokyo, RIKEN AIP</p> </blockquote> <hr> <blockquote> <h2 id="0-inference">0. inference</h2> </blockquote> <p>inference는 아래와 같이 수행할 수 있다고 한다.</p> <p><code class="language-plaintext highlighter-rouge">inference.py</code> 부분을 살펴보면, build_model함수로 GAGAvatars model을 만들어서 model을 불러오는데 해당 부분이 아마 중요한 의미들을 많이 담고 있을 것 같은데 해당 부분은 다음 section에서 따로 더 찾아보는 것으로 해야겠다. 일단은 GAGAvatars model을 불러왔다는 가정으로 시작한다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td> <td class="code"><pre><span class="c1"># Driven by another image:
# This will track the images online, which is slow.
</span><span class="n">python</span> <span class="n">inference</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">d</span> <span class="p">.</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="mf">2.j</span><span class="n">pg</span> <span class="o">-</span><span class="n">i</span> <span class="p">.</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="mf">1.j</span><span class="n">pg</span>

<span class="c1"># Driven by a tracked video:
</span><span class="n">python</span> <span class="n">inference</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">d</span> <span class="p">.</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">drivers</span><span class="o">/</span><span class="n">obama</span> <span class="o">-</span><span class="n">i</span> <span class="p">.</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="mf">1.j</span><span class="n">pg</span>

<span class="c1"># Driven by a tracked image_lmdb
</span><span class="n">python</span> <span class="n">inference</span><span class="p">.</span><span class="n">py</span> <span class="o">-</span><span class="n">d</span> <span class="p">.</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">drivers</span><span class="o">/</span><span class="n">vfhq_demo</span> <span class="o">-</span><span class="n">i</span> <span class="p">.</span><span class="o">/</span><span class="n">demos</span><span class="o">/</span><span class="n">examples</span><span class="o">/</span><span class="mf">1.j</span><span class="n">pg</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>아래와 같이 GAGAvatars model과 monocular face trucker인 GAGAvatar_Track model을 초기화 해준다.</p> <p>결국 face trucker model은 단일 이미지, 카메라에 대해 FLAME parameters와 camera parameters를 예측하여 반환하는 모델이다.</p> <p>그렇게 reference image와 track_engine을 이용하여 <code class="language-plaintext highlighter-rouge">feature_data</code>를 반환 받게 된다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td> <td class="code"><pre><span class="n">model</span> <span class="o">=</span> <span class="nf">build_model</span><span class="p">(</span><span class="n">model_cfg</span><span class="o">=</span><span class="n">meta_cfg</span><span class="p">.</span><span class="n">MODEL</span><span class="p">)</span>
<span class="bp">...</span>
<span class="n">track_engine</span> <span class="o">=</span> <span class="nc">TrackEngine</span><span class="p">(</span><span class="n">focal_length</span><span class="o">=</span><span class="mf">12.0</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="n">device</span><span class="p">)</span>

<span class="n">feature_name</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">image_path</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">feature_data</span> <span class="o">=</span> <span class="nf">get_tracked_results</span><span class="p">(</span><span class="n">image_path</span><span class="p">,</span> <span class="n">track_engine</span><span class="p">,</span> <span class="n">force_retrack</span><span class="o">=</span><span class="n">force_retrack</span><span class="p">)</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>driving image에 대해서도 위와 같은 일련의 과정으로 tacking을 하여 driver_data를 준비한다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td> <td class="code"><pre><span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isdir</span><span class="p">(</span><span class="n">driver_path</span><span class="p">):</span>
    <span class="n">driver_name</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">driver_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">driver_path</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span> <span class="k">else</span> <span class="n">driver_path</span><span class="p">)</span>
    <span class="n">driver_dataset</span> <span class="o">=</span> <span class="nc">DriverData</span><span class="p">(</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">feature_data</span><span class="p">,</span> <span class="n">meta_cfg</span><span class="p">.</span><span class="n">DATASET</span><span class="p">.</span><span class="n">POINT_PLANE_SIZE</span><span class="p">)</span>
    <span class="n">driver_dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nc">DataLoader</span><span class="p">(</span><span class="n">driver_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">driver_name</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">driver_path</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">driver_data</span> <span class="o">=</span> <span class="nf">get_tracked_results</span><span class="p">(</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">track_engine</span><span class="p">,</span> <span class="n">force_retrack</span><span class="o">=</span><span class="n">force_retrack</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">driver_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Finish inference, no face in driver: </span><span class="si">{</span><span class="n">image_path</span><span class="si">}</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">driver_dataset</span> <span class="o">=</span> <span class="nc">DriverData</span><span class="p">({</span><span class="n">driver_name</span><span class="p">:</span> <span class="n">driver_data</span><span class="p">},</span> <span class="n">feature_data</span><span class="p">,</span> <span class="n">meta_cfg</span><span class="p">.</span><span class="n">DATASET</span><span class="p">.</span><span class="n">POINT_PLANE_SIZE</span><span class="p">)</span>
    <span class="n">driver_dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nc">DataLoader</span><span class="p">(</span><span class="n">driver_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></td> </tr></tbody></table></code></pre></figure> <hr> <blockquote> <h2 id="1-gagavatars-model">1. GAGAvatars Model</h2> </blockquote> <p>위에서 확인했던 inference.py에는 module화된 조각들을 잘 처리하는 pipeline자체를 보여주고 있기 때문에 사실상 어떠한 과정이 진행되고 있는지에 대한 부분을 확인하기는 어렵다.</p> <p>model config file을 보더라도 model을 불러올 때 <code class="language-plaintext highlighter-rouge">models/GAGAvatar/models.py</code>에서의 GAGAvatar class를 불러오고 있다. 해당 model의 init 속성을 보았을 때 논문의 Reconstruction Branch를 수행하는 것으로 예상이 된다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td> <td class="code"><pre><span class="k">class</span> <span class="nc">GAGAvatar</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">model_cfg</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">self</span><span class="p">.</span><span class="n">base_model</span> <span class="o">=</span> <span class="nc">DINOBase</span><span class="p">(</span><span class="n">output_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">param</span> <span class="ow">in</span> <span class="n">self</span><span class="p">.</span><span class="n">base_model</span><span class="p">.</span><span class="n">dino_model</span><span class="p">.</span><span class="nf">parameters</span><span class="p">():</span>
            <span class="n">param</span><span class="p">.</span><span class="n">requires_grad</span> <span class="o">=</span> <span class="bp">False</span>
        <span class="c1"># dir_encoder
</span>        <span class="n">n_harmonic_dir</span> <span class="o">=</span> <span class="mi">4</span>
        <span class="n">self</span><span class="p">.</span><span class="n">direnc_dim</span> <span class="o">=</span> <span class="n">n_harmonic_dir</span> <span class="o">*</span> <span class="mi">2</span> <span class="o">*</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">3</span>
        <span class="n">self</span><span class="p">.</span><span class="n">harmo_encoder</span> <span class="o">=</span> <span class="nc">HarmonicEmbedding</span><span class="p">(</span><span class="n">n_harmonic_dir</span><span class="p">)</span>
        <span class="c1"># pre_trained
</span>        <span class="n">self</span><span class="p">.</span><span class="n">head_base</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Parameter</span><span class="p">(</span><span class="n">torch</span><span class="p">.</span><span class="nf">randn</span><span class="p">(</span><span class="mi">5023</span><span class="p">,</span> <span class="mi">256</span><span class="p">),</span> <span class="n">requires_grad</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">gs_generator_g</span> <span class="o">=</span> <span class="nc">LinearGSGenerator</span><span class="p">(</span><span class="n">in_dim</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">dir_dim</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">direnc_dim</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">gs_generator_l0</span> <span class="o">=</span> <span class="nc">ConvGSGenerator</span><span class="p">(</span><span class="n">in_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">dir_dim</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">direnc_dim</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">gs_generator_l1</span> <span class="o">=</span> <span class="nc">ConvGSGenerator</span><span class="p">(</span><span class="n">in_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">dir_dim</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">direnc_dim</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">cam_params</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">focal_x</span><span class="sh">'</span><span class="p">:</span> <span class="mf">12.0</span><span class="p">,</span> <span class="sh">'</span><span class="s">focal_y</span><span class="sh">'</span><span class="p">:</span> <span class="mf">12.0</span><span class="p">,</span> <span class="sh">'</span><span class="s">size</span><span class="sh">'</span><span class="p">:</span> <span class="p">[</span><span class="mi">512</span><span class="p">,</span> <span class="mi">512</span><span class="p">]}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">upsampler</span> <span class="o">=</span> <span class="nc">StyleUNet</span><span class="p">(</span><span class="n">in_size</span><span class="o">=</span><span class="mi">512</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">out_dim</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">out_size</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">percep_loss</span> <span class="o">=</span> <span class="nc">FacePerceptualLoss</span><span class="p">(</span><span class="n">loss_type</span><span class="o">=</span><span class="sh">'</span><span class="s">l1</span><span class="sh">'</span><span class="p">,</span> <span class="n">weighted</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>하나씩 살펴보자. 먼저 <code class="language-plaintext highlighter-rouge">self.gs_generator_g</code>는 <code class="language-plaintext highlighter-rouge">LinearGSGenerator</code> model을 사용한다. 해당 class model은 밑에 정의 되어 있다.</p> <p>보면 Lienar,ReLU의 조합으로 구성된 Sequential 형태이다. 입력으로 들어오는 input_features와 plane_direnc에 대하여 gaussian parameter를 추출 할 수 있는 형태로 설계 되어 있다. 아마 이 부분은 train에서 충분히 학습되어 weight가 담겨있을 것 같다.</p> <p>그리고 해당 부분은 위 Expression Branch에서 사용되는 global part형태에 사용되는 gs로 확인이 된다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td> <td class="code"><pre><span class="c1"># global part
</span><span class="n">gs_params_g</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">gs_generator_g</span><span class="p">(</span>
        <span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span>
            <span class="n">self</span><span class="p">.</span><span class="n">head_base</span><span class="p">[</span><span class="bp">None</span><span class="p">].</span><span class="nf">expand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">f_feature1</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">].</span><span class="nf">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5023</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> 
        <span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span>
    <span class="p">),</span> <span class="n">plane_direnc</span>
<span class="p">)</span>
<span class="n">gs_params_g</span><span class="p">[</span><span class="sh">'</span><span class="s">xyz</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_points</span>
</pre></td> </tr></tbody></table></code></pre></figure> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
</pre></td> <td class="code"><pre><span class="k">class</span> <span class="nc">LinearGSGenerator</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span> <span class="n">dir_dim</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="c1"># params
</span>        <span class="n">self</span><span class="p">.</span><span class="n">feature_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">in_dim</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">in_dim</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">in_dim</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">in_dim</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">//</span><span class="mi">4</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">layer_in_dim</span> <span class="o">=</span> <span class="n">in_dim</span><span class="o">//</span><span class="mi">4</span> <span class="o">+</span> <span class="n">dir_dim</span>
        <span class="n">self</span><span class="p">.</span><span class="n">color_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">layer_in_dim</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">32</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">opacity_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">layer_in_dim</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">scale_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">layer_in_dim</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="p">)</span>
        <span class="n">self</span><span class="p">.</span><span class="n">rotation_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="n">layer_in_dim</span><span class="p">,</span> <span class="mi">128</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Linear</span><span class="p">(</span><span class="mi">128</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">bias</span><span class="o">=</span><span class="bp">True</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">,</span> <span class="n">plane_direnc</span><span class="p">):</span>
        <span class="n">input_features</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">feature_layers</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span>
        <span class="n">plane_direnc</span> <span class="o">=</span> <span class="n">plane_direnc</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">].</span><span class="nf">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">input_features</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">input_features</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">input_features</span><span class="p">,</span> <span class="n">plane_direnc</span><span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
        <span class="c1"># color
</span>        <span class="n">colors</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">color_layers</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span>
        <span class="n">colors</span><span class="p">[...,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">colors</span><span class="p">[...,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="c1"># opacity
</span>        <span class="n">opacities</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">opacity_layers</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span>
        <span class="n">opacities</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">opacities</span><span class="p">)</span>
        <span class="c1"># scale
</span>        <span class="n">scales</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">scale_layers</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span>
        <span class="c1"># scales = torch.exp(scales) * 0.01
</span>        <span class="n">scales</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.05</span>
        <span class="c1"># rotation
</span>        <span class="n">rotations</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">rotation_layers</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span>
        <span class="n">rotations</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">functional</span><span class="p">.</span><span class="nf">normalize</span><span class="p">(</span><span class="n">rotations</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="sh">'</span><span class="s">colors</span><span class="sh">'</span><span class="p">:</span><span class="n">colors</span><span class="p">,</span> <span class="sh">'</span><span class="s">opacities</span><span class="sh">'</span><span class="p">:</span><span class="n">opacities</span><span class="p">,</span> <span class="sh">'</span><span class="s">scales</span><span class="sh">'</span><span class="p">:</span><span class="n">scales</span><span class="p">,</span> <span class="sh">'</span><span class="s">rotations</span><span class="sh">'</span><span class="p">:</span><span class="n">rotations</span><span class="p">}</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>밑에 해당 <code class="language-plaintext highlighter-rouge">self.gs_generator_10</code> 과 <code class="language-plaintext highlighter-rouge">self.gs_generator_l1</code>은 local DINO에서 추출된 local feature에 대한 dual-lifting에 관한 코드 부분이다. feature와 plane_direnc에 대하여 양쪽으로 gaussian을 예측하여 Gaussian을 두 층으로 예측을 하게 된다. Gaussian의 parameter를 예측할 때는 Global과는 다르게 얇은 Conv층으로 <code class="language-plaintext highlighter-rouge">32+1+3+4+1</code>의 gaussian parameter들을 예측한다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td> <td class="code"><pre> <span class="c1"># local part
</span><span class="n">gs_params_l0</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">gs_generator_l0</span><span class="p">(</span><span class="n">f_feature0</span><span class="p">,</span> <span class="n">plane_direnc</span><span class="p">)</span>
<span class="n">gs_params_l1</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">gs_generator_l1</span><span class="p">(</span><span class="n">f_feature0</span><span class="p">,</span> <span class="n">plane_direnc</span><span class="p">)</span>
<span class="n">gs_params_l0</span><span class="p">[</span><span class="sh">'</span><span class="s">xyz</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_planes</span><span class="p">[</span><span class="sh">'</span><span class="s">plane_points</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">gs_params_l0</span><span class="p">[</span><span class="sh">'</span><span class="s">positions</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">f_planes</span><span class="p">[</span><span class="sh">'</span><span class="s">plane_dirs</span><span class="sh">'</span><span class="p">][:,</span> <span class="bp">None</span><span class="p">]</span>
<span class="n">gs_params_l1</span><span class="p">[</span><span class="sh">'</span><span class="s">xyz</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_planes</span><span class="p">[</span><span class="sh">'</span><span class="s">plane_points</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">gs_params_l1</span><span class="p">[</span><span class="sh">'</span><span class="s">positions</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">f_planes</span><span class="p">[</span><span class="sh">'</span><span class="s">plane_dirs</span><span class="sh">'</span><span class="p">][:,</span> <span class="bp">None</span><span class="p">]</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>궁금한 부분은 해당 두께의 Conv층으로 충분히 해당 Gaussian Parameter들이 잘 예측이 될 수 있는건지이다.</p> <p>GPT에게 물어봤을 때는 이 부분은 당연히 가능하다는 의견이다. 애초에 DINO에서 추출한 feature형태가 저차원의 형태가 아닌 고차원의 형태이고 지금 현재 상황에서는 아예 다른 차원으로써의 이동이 아닌 mapping에 가까운 의도이기 때문에 이정도 깊이의 conv로 해당 역할을 수행하는 것은 일반적인 쪽에 가깝다고 한다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td> <td class="code"><pre><span class="k">class</span> <span class="nc">ConvGSGenerator</span><span class="p">(</span><span class="n">nn</span><span class="p">.</span><span class="n">Module</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">=</span><span class="mi">256</span><span class="p">,</span> <span class="n">dir_dim</span><span class="o">=</span><span class="mi">27</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="nf">super</span><span class="p">().</span><span class="nf">__init__</span><span class="p">()</span>
        <span class="n">out_dim</span> <span class="o">=</span> <span class="mi">32</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">1</span> <span class="c1"># color + opacity + scale + rotation + position
</span>        <span class="n">self</span><span class="p">.</span><span class="n">gaussian_conv</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="nc">Sequential</span><span class="p">(</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="n">in_dim</span><span class="o">+</span><span class="n">dir_dim</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="n">in_dim</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="n">in_dim</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">in_dim</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">ReLU</span><span class="p">(),</span>
            <span class="n">nn</span><span class="p">.</span><span class="nc">Conv2d</span><span class="p">(</span><span class="n">in_dim</span><span class="o">//</span><span class="mi">2</span><span class="p">,</span> <span class="n">out_dim</span><span class="p">,</span> <span class="n">kernel_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">stride</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">padding</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">input_features</span><span class="p">,</span> <span class="n">plane_direnc</span><span class="p">):</span>
        <span class="n">plane_direnc</span> <span class="o">=</span> <span class="n">plane_direnc</span><span class="p">[:,</span> <span class="p">:,</span> <span class="bp">None</span><span class="p">,</span> <span class="bp">None</span><span class="p">].</span><span class="nf">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">input_features</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">input_features</span><span class="p">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
        <span class="n">input_features</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">input_features</span><span class="p">,</span> <span class="n">plane_direnc</span><span class="p">],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="n">gaussian_params</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">gaussian_conv</span><span class="p">(</span><span class="n">input_features</span><span class="p">)</span>
        <span class="c1"># color
</span>        <span class="n">colors</span> <span class="o">=</span> <span class="n">gaussian_params</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">32</span><span class="p">]</span>
        <span class="n">colors</span><span class="p">[...,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">colors</span><span class="p">[...,</span> <span class="p">:</span><span class="mi">3</span><span class="p">])</span>
        <span class="c1"># opacity
</span>        <span class="n">opacities</span> <span class="o">=</span> <span class="n">gaussian_params</span><span class="p">[:,</span> <span class="mi">32</span><span class="p">:</span><span class="mi">33</span><span class="p">]</span>
        <span class="n">opacities</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">opacities</span><span class="p">)</span>
        <span class="c1"># scale
</span>        <span class="n">scales</span> <span class="o">=</span> <span class="n">gaussian_params</span><span class="p">[:,</span> <span class="mi">33</span><span class="p">:</span><span class="mi">36</span><span class="p">]</span>
        <span class="c1"># scales = torch.exp(scales) * 0.01
</span>        <span class="n">scales</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">scales</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.05</span>
        <span class="c1"># rotation
</span>        <span class="n">rotations</span> <span class="o">=</span> <span class="n">gaussian_params</span><span class="p">[:,</span> <span class="mi">36</span><span class="p">:</span><span class="mi">40</span><span class="p">]</span>
        <span class="n">rotations</span> <span class="o">=</span> <span class="n">nn</span><span class="p">.</span><span class="n">functional</span><span class="p">.</span><span class="nf">normalize</span><span class="p">(</span><span class="n">rotations</span><span class="p">)</span>
        <span class="c1"># position
</span>        <span class="n">positions</span> <span class="o">=</span> <span class="n">gaussian_params</span><span class="p">[:,</span> <span class="mi">40</span><span class="p">:</span><span class="mi">41</span><span class="p">]</span>
        <span class="n">positions</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">sigmoid</span><span class="p">(</span><span class="n">positions</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">{</span><span class="sh">'</span><span class="s">colors</span><span class="sh">'</span><span class="p">:</span><span class="n">colors</span><span class="p">,</span> <span class="sh">'</span><span class="s">opacities</span><span class="sh">'</span><span class="p">:</span><span class="n">opacities</span><span class="p">,</span> <span class="sh">'</span><span class="s">scales</span><span class="sh">'</span><span class="p">:</span><span class="n">scales</span><span class="p">,</span> <span class="sh">'</span><span class="s">rotations</span><span class="sh">'</span><span class="p">:</span><span class="n">rotations</span><span class="p">,</span> <span class="sh">'</span><span class="s">positions</span><span class="sh">'</span><span class="p">:</span><span class="n">positions</span><span class="p">}</span>
        <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">results</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
            <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="nf">permute</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">).</span><span class="nf">reshape</span><span class="p">(</span><span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="n">results</span><span class="p">[</span><span class="n">key</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">return</span> <span class="n">results</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>그럼 그렇게 위에서 global하게 나온 head의 gaussian과 밑에서 dual-lifting으로 나온 두 개의 gaussian을 concat하여 하나의 gaussian scene으로 구성하게 된다. 그렇게 image를 생성해서 dict형태의 results로 반환이 되게 된다.</p> <p>이게 위에 dual-lifting으로 plane에 예측되는 gaussian points의 개수가 $(H,W) = 296 \times 296$ 형태로 나오고 2개의 층으로 나오기 때문에 175,232개의 point가 나온다고 한다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td> <td class="code"><pre><span class="n">gs_params</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">k</span><span class="p">:</span><span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">gs_params_g</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">gs_params_l0</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">gs_params_l1</span><span class="p">[</span><span class="n">k</span><span class="p">]],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gs_params_g</span><span class="p">.</span><span class="nf">keys</span><span class="p">()</span>
<span class="p">}</span>
<span class="n">gen_images</span> <span class="o">=</span> <span class="nf">render_gaussian</span><span class="p">(</span>
    <span class="n">gs_params</span><span class="o">=</span><span class="n">gs_params</span><span class="p">,</span> <span class="n">cam_matrix</span><span class="o">=</span><span class="n">t_transform</span><span class="p">,</span> <span class="n">cam_params</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">cam_params</span>
<span class="p">)[</span><span class="sh">'</span><span class="s">images</span><span class="sh">'</span><span class="p">]</span>
<span class="n">sr_gen_images</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">upsampler</span><span class="p">(</span><span class="n">gen_images</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
    <span class="sh">'</span><span class="s">t_image</span><span class="sh">'</span><span class="p">:</span><span class="n">t_image</span><span class="p">,</span> <span class="sh">'</span><span class="s">t_bbox</span><span class="sh">'</span><span class="p">:</span><span class="n">t_bbox</span><span class="p">,</span> <span class="sh">'</span><span class="s">t_points</span><span class="sh">'</span><span class="p">:</span> <span class="n">t_points</span><span class="p">,</span> 
    <span class="sh">'</span><span class="s">p_points</span><span class="sh">'</span><span class="p">:</span> <span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">gs_params_l0</span><span class="p">[</span><span class="sh">'</span><span class="s">xyz</span><span class="sh">'</span><span class="p">],</span> <span class="n">gs_params_l1</span><span class="p">[</span><span class="sh">'</span><span class="s">xyz</span><span class="sh">'</span><span class="p">]],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="sh">'</span><span class="s">gen_image</span><span class="sh">'</span><span class="p">:</span> <span class="n">gen_images</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="sh">'</span><span class="s">sr_gen_image</span><span class="sh">'</span><span class="p">:</span> <span class="n">sr_gen_images</span>
<span class="p">}</span>
<span class="k">return</span> <span class="n">results</span>
</pre></td> </tr></tbody></table></code></pre></figure> <hr> <h2 id="2-forward_expression">2. forward_expression</h2> <p>위에서 Reconstruction branch에서의 Dual-lifting gaussian과 expression branch에서의 gaussian을 concat하여 하나의 gaussian으로 표현하는 것 까지 보았다.</p> <p>이번 <code class="language-plaintext highlighter-rouge">forward_expression</code>에서는 expression 하는 것에 대해서는 어떻게 forward되는 것인지에 대한 부분이다. 위의 기존 <code class="language-plaintext highlighter-rouge">forward</code>를 진행했다는 가정하에 <code class="language-plaintext highlighter-rouge">_gs_params</code>에는 기존 Source image에 대한 reconstruction gaussian과 expression gaussian이 concat되어 있는 상황이다. 입력으로 들어오는 batch의 t_points를 이용하여 expression gaussian의 point 좌표를 해당 t_points로 갈아끼워 준다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td> <td class="code"><pre><span class="nd">@torch.no_grad</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">forward_expression</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">'</span><span class="s">_gs_params</span><span class="sh">'</span><span class="p">):</span>
        <span class="n">batch_size</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="sh">'</span><span class="s">f_image</span><span class="sh">'</span><span class="p">].</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">f_image</span><span class="p">,</span> <span class="n">f_planes</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="sh">'</span><span class="s">f_image</span><span class="sh">'</span><span class="p">],</span> <span class="n">batch</span><span class="p">[</span><span class="sh">'</span><span class="s">f_planes</span><span class="sh">'</span><span class="p">]</span>
        <span class="n">f_feature0</span><span class="p">,</span> <span class="n">f_feature1</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">base_model</span><span class="p">(</span><span class="n">f_image</span><span class="p">)</span>
        <span class="c1"># dir encoding
</span>        <span class="n">plane_direnc</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">harmo_encoder</span><span class="p">(</span><span class="n">f_planes</span><span class="p">[</span><span class="sh">'</span><span class="s">plane_dirs</span><span class="sh">'</span><span class="p">])</span>
        <span class="c1"># global part
</span>        <span class="n">gs_params_g</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">gs_generator_g</span><span class="p">(</span>
            <span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span>
                    <span class="n">self</span><span class="p">.</span><span class="n">head_base</span><span class="p">[</span><span class="bp">None</span><span class="p">].</span><span class="nf">expand</span><span class="p">(</span><span class="n">batch_size</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> <span class="n">f_feature1</span><span class="p">[:,</span> <span class="bp">None</span><span class="p">].</span><span class="nf">expand</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5023</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">),</span> 
                <span class="p">],</span> <span class="n">dim</span><span class="o">=-</span><span class="mi">1</span>
            <span class="p">),</span> <span class="n">plane_direnc</span>
        <span class="p">)</span>
        <span class="n">gs_params_g</span><span class="p">[</span><span class="sh">'</span><span class="s">xyz</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="sh">'</span><span class="s">f_image</span><span class="sh">'</span><span class="p">].</span><span class="nf">new_zeros</span><span class="p">((</span><span class="n">batch_size</span><span class="p">,</span> <span class="mi">5023</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
        <span class="c1"># local part
</span>        <span class="n">gs_params_l0</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">gs_generator_l0</span><span class="p">(</span><span class="n">f_feature0</span><span class="p">,</span> <span class="n">plane_direnc</span><span class="p">)</span>
        <span class="n">gs_params_l1</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">gs_generator_l1</span><span class="p">(</span><span class="n">f_feature0</span><span class="p">,</span> <span class="n">plane_direnc</span><span class="p">)</span>
        <span class="n">gs_params_l0</span><span class="p">[</span><span class="sh">'</span><span class="s">xyz</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_planes</span><span class="p">[</span><span class="sh">'</span><span class="s">plane_points</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="n">gs_params_l0</span><span class="p">[</span><span class="sh">'</span><span class="s">positions</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">f_planes</span><span class="p">[</span><span class="sh">'</span><span class="s">plane_dirs</span><span class="sh">'</span><span class="p">][:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="n">gs_params_l1</span><span class="p">[</span><span class="sh">'</span><span class="s">xyz</span><span class="sh">'</span><span class="p">]</span> <span class="o">=</span> <span class="n">f_planes</span><span class="p">[</span><span class="sh">'</span><span class="s">plane_points</span><span class="sh">'</span><span class="p">]</span> <span class="o">+</span> <span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">gs_params_l1</span><span class="p">[</span><span class="sh">'</span><span class="s">positions</span><span class="sh">'</span><span class="p">]</span> <span class="o">*</span> <span class="n">f_planes</span><span class="p">[</span><span class="sh">'</span><span class="s">plane_dirs</span><span class="sh">'</span><span class="p">][:,</span> <span class="bp">None</span><span class="p">]</span>
        <span class="n">gs_params</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">k</span><span class="p">:</span><span class="n">torch</span><span class="p">.</span><span class="nf">cat</span><span class="p">([</span><span class="n">gs_params_g</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">gs_params_l0</span><span class="p">[</span><span class="n">k</span><span class="p">],</span> <span class="n">gs_params_l1</span><span class="p">[</span><span class="n">k</span><span class="p">]],</span> <span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="n">gs_params_g</span><span class="p">.</span><span class="nf">keys</span><span class="p">()</span>
        <span class="p">}</span>
        <span class="n">self</span><span class="p">.</span><span class="n">_gs_params</span> <span class="o">=</span> <span class="n">gs_params</span>
    <span class="n">gs_params</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_gs_params</span>
    <span class="n">t_image</span><span class="p">,</span> <span class="n">t_points</span><span class="p">,</span> <span class="n">t_transform</span> <span class="o">=</span> <span class="n">batch</span><span class="p">[</span><span class="sh">'</span><span class="s">t_image</span><span class="sh">'</span><span class="p">],</span> <span class="n">batch</span><span class="p">[</span><span class="sh">'</span><span class="s">t_points</span><span class="sh">'</span><span class="p">],</span> <span class="n">batch</span><span class="p">[</span><span class="sh">'</span><span class="s">t_transform</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">gs_params</span><span class="p">[</span><span class="sh">'</span><span class="s">xyz</span><span class="sh">'</span><span class="p">][:,</span> <span class="p">:</span><span class="mi">5023</span><span class="p">]</span> <span class="o">=</span> <span class="n">t_points</span>
    <span class="n">gen_images</span> <span class="o">=</span> <span class="nf">render_gaussian</span><span class="p">(</span>
        <span class="n">gs_params</span><span class="o">=</span><span class="n">gs_params</span><span class="p">,</span> <span class="n">cam_matrix</span><span class="o">=</span><span class="n">t_transform</span><span class="p">,</span> <span class="n">cam_params</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">cam_params</span>
    <span class="p">)[</span><span class="sh">'</span><span class="s">images</span><span class="sh">'</span><span class="p">]</span>
    <span class="n">sr_gen_images</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">upsampler</span><span class="p">(</span><span class="n">gen_images</span><span class="p">)</span>
    <span class="n">results</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">t_image</span><span class="sh">'</span><span class="p">:</span><span class="n">t_image</span><span class="p">,</span> <span class="sh">'</span><span class="s">gen_image</span><span class="sh">'</span><span class="p">:</span> <span class="n">gen_images</span><span class="p">[:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">],</span> <span class="sh">'</span><span class="s">sr_gen_image</span><span class="sh">'</span><span class="p">:</span> <span class="n">sr_gen_images</span><span class="p">,</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">results</span>
</pre></td> </tr></tbody></table></code></pre></figure> <p>의식의 흐름대로.. 그럼 batch에는 어떤 data가 들어오는 것인지를 따라가보면… 입력으로 들어오는 driven의 frame을 입력으로 받아서 <code class="language-plaintext highlighter-rouge">self.flame_model</code>에서 해당 frame의 index를 이용하여 t_points를 예측하게된다. 그렇다면 또 궁금해지는 부분이… <code class="language-plaintext highlighter-rouge">self.flame_model</code>에서 어떻게 t_points를 예측할 수 있는 것인가? 그것은 또 앞을 보면 되는데….</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td> <td class="code"><pre><span class="c1"># core/data/loader_track.py
</span><span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">index</span><span class="p">):</span>
    <span class="n">frame_key</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_frames</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">self</span><span class="p">.</span><span class="nf">_load_one_record</span><span class="p">(</span><span class="n">frame_key</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">_load_one_record</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="n">frame_key</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nf">hasattr</span><span class="p">(</span><span class="n">self</span><span class="p">,</span> <span class="sh">'</span><span class="s">_lmdb_engine</span><span class="sh">'</span><span class="p">):</span>
        <span class="n">self</span><span class="p">.</span><span class="nf">_init_lmdb_database</span><span class="p">()</span>
    <span class="n">this_record</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_data</span><span class="p">[</span><span class="n">frame_key</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">this_record</span><span class="p">.</span><span class="nf">keys</span><span class="p">():</span>
        <span class="k">if</span> <span class="nf">isinstance</span><span class="p">(</span><span class="n">this_record</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="n">np</span><span class="p">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">this_record</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="nf">tensor</span><span class="p">(</span><span class="n">this_record</span><span class="p">[</span><span class="n">key</span><span class="p">])</span>
    <span class="n">t_image</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="n">_lmdb_engine</span><span class="p">[</span><span class="n">frame_key</span><span class="p">].</span><span class="nf">float</span><span class="p">()</span> <span class="o">/</span> <span class="mf">255.0</span>
    <span class="n">t_points</span> <span class="o">=</span> <span class="n">self</span><span class="p">.</span><span class="nf">flame_model</span><span class="p">(</span>
        <span class="n">shape_params</span><span class="o">=</span><span class="n">self</span><span class="p">.</span><span class="n">f_shape</span><span class="p">[</span><span class="bp">None</span><span class="p">],</span> <span class="n">pose_params</span><span class="o">=</span><span class="n">this_record</span><span class="p">[</span><span class="sh">'</span><span class="s">posecode</span><span class="sh">'</span><span class="p">][</span><span class="bp">None</span><span class="p">],</span>
        <span class="n">expression_params</span><span class="o">=</span><span class="n">this_record</span><span class="p">[</span><span class="sh">'</span><span class="s">expcode</span><span class="sh">'</span><span class="p">][</span><span class="bp">None</span><span class="p">],</span> <span class="n">eye_pose_params</span><span class="o">=</span><span class="n">this_record</span><span class="p">[</span><span class="sh">'</span><span class="s">eyecode</span><span class="sh">'</span><span class="p">][</span><span class="bp">None</span><span class="p">],</span>
    <span class="p">)[</span><span class="mi">0</span><span class="p">].</span><span class="nf">float</span><span class="p">()</span>
    <span class="n">one_data</span> <span class="o">=</span> <span class="p">{</span>
        <span class="sh">'</span><span class="s">f_image</span><span class="sh">'</span><span class="p">:</span> <span class="nf">deepcopy</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f_image</span><span class="p">),</span> <span class="sh">'</span><span class="s">f_planes</span><span class="sh">'</span><span class="p">:</span> <span class="nf">deepcopy</span><span class="p">(</span><span class="n">self</span><span class="p">.</span><span class="n">f_planes</span><span class="p">),</span> 
        <span class="sh">'</span><span class="s">t_image</span><span class="sh">'</span><span class="p">:</span> <span class="n">t_image</span><span class="p">,</span> <span class="sh">'</span><span class="s">t_points</span><span class="sh">'</span><span class="p">:</span> <span class="n">t_points</span><span class="p">,</span> <span class="sh">'</span><span class="s">t_transform</span><span class="sh">'</span><span class="p">:</span> <span class="n">this_record</span><span class="p">[</span><span class="sh">'</span><span class="s">transform_matrix</span><span class="sh">'</span><span class="p">],</span> 
        <span class="sh">'</span><span class="s">infos</span><span class="sh">'</span><span class="p">:</span> <span class="p">{</span><span class="sh">'</span><span class="s">t_key</span><span class="sh">'</span><span class="p">:</span><span class="n">frame_key</span><span class="p">},</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">one_data</span>    
</pre></td> </tr></tbody></table></code></pre></figure> <p><code class="language-plaintext highlighter-rouge">inference.py</code>를 살펴보면 애초에 <code class="language-plaintext highlighter-rouge">train.py</code>를 통해 driver_data가 있다고 가정을 한다. 만약 없을 경우 tracking을 하게 되는데, 결국엔 tracking을 함으로써 driver_data를 얻게 된다.</p> <figure class="highlight"><pre><code class="language-python" data-lang="python"><table class="rouge-table"><tbody><tr>
<td class="gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td> <td class="code"><pre><span class="c1"># inference.py
</span><span class="k">if</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">isdir</span><span class="p">(</span><span class="n">driver_path</span><span class="p">):</span>
    <span class="n">driver_name</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">driver_path</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="k">if</span> <span class="n">driver_path</span><span class="p">.</span><span class="nf">endswith</span><span class="p">(</span><span class="sh">'</span><span class="s">/</span><span class="sh">'</span><span class="p">)</span> <span class="k">else</span> <span class="n">driver_path</span><span class="p">)</span>
    <span class="n">driver_dataset</span> <span class="o">=</span> <span class="nc">DriverData</span><span class="p">(</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">feature_data</span><span class="p">,</span> <span class="n">meta_cfg</span><span class="p">.</span><span class="n">DATASET</span><span class="p">.</span><span class="n">POINT_PLANE_SIZE</span><span class="p">)</span>
    <span class="n">driver_dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nc">DataLoader</span><span class="p">(</span><span class="n">driver_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">driver_name</span> <span class="o">=</span> <span class="n">os</span><span class="p">.</span><span class="n">path</span><span class="p">.</span><span class="nf">basename</span><span class="p">(</span><span class="n">driver_path</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="sh">'</span><span class="s">.</span><span class="sh">'</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">driver_data</span> <span class="o">=</span> <span class="nf">get_tracked_results</span><span class="p">(</span><span class="n">driver_path</span><span class="p">,</span> <span class="n">track_engine</span><span class="p">,</span> <span class="n">force_retrack</span><span class="o">=</span><span class="n">force_retrack</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">driver_data</span> <span class="ow">is</span> <span class="bp">None</span><span class="p">:</span>
        <span class="nf">print</span><span class="p">(</span><span class="sa">f</span><span class="sh">'</span><span class="s">Finish inference, no face in driver: </span><span class="si">{</span><span class="n">image_path</span><span class="si">}</span><span class="s">.</span><span class="sh">'</span><span class="p">)</span>
        <span class="k">return</span>
    <span class="n">driver_dataset</span> <span class="o">=</span> <span class="nc">DriverData</span><span class="p">({</span><span class="n">driver_name</span><span class="p">:</span> <span class="n">driver_data</span><span class="p">},</span> <span class="n">feature_data</span><span class="p">,</span> <span class="n">meta_cfg</span><span class="p">.</span><span class="n">DATASET</span><span class="p">.</span><span class="n">POINT_PLANE_SIZE</span><span class="p">)</span>
    <span class="n">driver_dataloader</span> <span class="o">=</span> <span class="n">torch</span><span class="p">.</span><span class="n">utils</span><span class="p">.</span><span class="n">data</span><span class="p">.</span><span class="nc">DataLoader</span><span class="p">(</span><span class="n">driver_dataset</span><span class="p">,</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">num_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></td> </tr></tbody></table></code></pre></figure> </div> </article> <br> <hr> <br> <ul class="list-disc pl-8"></ul> <h2 class="text-3xl font-semibold mb-4 mt-12">Enjoy Reading This Article?</h2> <p class="mb-2">Here are some more articles you might like to read next:</p> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/Research_decision/">[Research] CVPR 2026 Final Decision</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2026/Research_rebuttal/">[Research] CVPR 2026 Rebuttal</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/papers_img2img_turbo/">[Papers] One-Step Image Translation with Text-to-Image Models (Preprint)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/papers_FaceLift/">[Papers] FaceLift: Learning Generalizable Single Image 3D Face Reconstruction from Synthetic Heads (ICCV 2025)</a> </li> <li class="my-2"> <a class="text-pink-700 underline font-semibold hover:text-pink-800" href="/blog/2025/papers_CAP4D/">[Papers] CAP4D: Creating Animatable 4D Portrait Avatars with Morphable Multi-View Diffusion Models (CVPR 2025 Oral)</a> </li> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2026 owei . Powered by <a href="https://jekyllrb.com/" target="_blank" rel="external nofollow noopener">Jekyll</a> with <a href="https://github.com/alshedivat/al-folio" rel="external nofollow noopener" target="_blank">al-folio</a> theme. Hosted by <a href="https://pages.github.com/" target="_blank" rel="external nofollow noopener">GitHub Pages</a>. Photos from <a href="https://unsplash.com" target="_blank" rel="external nofollow noopener">Unsplash</a>. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> </body> </html>